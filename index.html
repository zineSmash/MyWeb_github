<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <title>나의 첫 웹페이지</title> -->
    <title>글 작성하기</title> 
</head>
<body>
    <!-- <h1>안녕하세요! 이것은 제가 만든 첫 웹페이지입니다.</h1>
    <p>이 페이지는 Github Pages를 통해 공개됩니다.</p> -->
    <h1>게시글 작성</h1>
    <form id="postForm">
        <input type="text" id="title" placeholder="제목" required><br>
        <textarea id="content" placeholder="내용" required></textarea><br>
        <button type="submit">글 작성</button>
    </form>

    <h2>게시글 목록</h2>
    <ul id="postsList"></ul>

    <script>
        const BASE_URL = 'https://myweb-github.onrender.com';

        // 글 작성 폼 제출 시
        document.getElementById('postForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const titleInput = document.getElementById('title');
            const contentInput = document.getElementById('content');
            const submitBtn = this.querySelector('button[type="submit"]');

            const title = titleInput.value;
            const content = contentInput.value;

            // 작성 버튼 누르면 버튼 비활성화 하기 + 로딩 텍스트 표시
            submitBtn.disabled = true;
            submitBtn.textContent = "작성 중...";

        try {
            const response = await fetch(`${BASE_URL}/posts`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title, content })
            });

            if (response.ok) {
                alert('글 작성 완료');
                titleInput.value = '';
                contentInput.value = '';
                loadPosts(); // 새로고침 없이 목록 갱신
            } else {
                alert('글 작성 실패');
            }
        } catch (err) {
            alert('네트워크 오류');
        } finally {
            submitBtn.disabled = false; // 버튼 재활성화
            submitBtn.textContent = "글 작성";
        }
        });

        // 글 목록 불러오기
        async function loadPosts() {
            const res = await fetch(`${BASE_URL}/posts`);
            const posts = await res.json();

            const list = document.getElementById('postsList');
            list.innerHTML = '';
            posts.forEach(post => {
                const li = document.createElement('li');
                li.textContent = `${post.title} - ${post.content}`;
                list.appendChild(li);
            });
        }

        // 페이지 열리면 글 목록 불러오기
        window.onload = loadPosts;
    </script>
</body>
</html>